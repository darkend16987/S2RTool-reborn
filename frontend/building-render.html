<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Render - S2R Tool</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
</head>
<body>

    <!-- HEADER -->
    <header class="app-header">
        <div class="header-content">
            <h1>
                <span class="material-symbols-rounded">apartment</span>
                Building Render
            </h1>
            <span class="header-divider"></span>
            <p class="header-subtitle">Sketch to Photorealistic Render • Powered by Gemini AI</p>
        </div>
    </header>

    <!-- BACK TO HOME -->
    <nav class="back-nav">
        <a href="index.html" class="back-link">
            <span class="material-symbols-rounded">arrow_back</span>
            Về trang chủ
        </a>
    </nav>



    <!-- ✅ BUILDING MODE CONTAINER -->
    <div class="main-container">
        
        <!-- =============================================== -->
        <!-- COLUMN 1: INPUT SKETCH -->
        <!-- =============================================== -->
        <aside class="panel panel-input">
            <div class="panel-header">
                <span class="step-badge">Bước 1</span>
                <h2>Upload Sketch</h2>
            </div>
            
            <!-- Image Uploader -->
            <div id="imageUploader" class="image-uploader">
                <input type="file" id="uploadSketch" accept="image/*" style="display: none;">
                <label for="uploadSketch" id="uploadLabel" class="upload-label">
                    <span class="material-symbols-rounded">cloud_upload</span>
                    <span class="upload-text">Kéo thả hoặc nhấn để tải ảnh</span>
                    <span class="upload-hint">JPG, PNG • Max 16MB</span>
                </label>
                <img id="previewImage" src="" alt="Sketch preview" class="preview-image hidden">
            </div>

            <!-- Analyze Button -->
            <button id="analyzeSketchButton" class="btn-primary" disabled>
                <span id="analyzeSpinner" class="spinner hidden"></span>
                <span class="material-symbols-rounded">auto_awesome</span>
                Phân tích Sketch (AI)
            </button>
            
            <!-- Messages -->
            <div id="analyzeError" class="message error-message hidden"></div>
            <div id="analyzeSuccess" class="message success-message hidden"></div>
            
            <!-- Info Box -->
            <div class="info-box">
                <strong><span class="material-symbols-rounded icon-sm">lightbulb</span> Tips:</strong>
                <ul>
                    <li>Sketch rõ ràng, đủ chi tiết</li>
                    <li>Tỷ lệ chuẩn, góc nhìn thẳng</li>
                    <li>Có thể là vẽ tay hoặc CAD</li>
                </ul>
            </div>
        </aside>

        <!-- =============================================== -->
        <!-- COLUMN 2: PARAMETERS FORM -->
        <!-- =============================================== -->
        <main class="panel panel-form">
            <div class="panel-header">
                <span class="step-badge">Bước 2</span>
                <h2>Tinh chỉnh Thông số</h2>
            </div>
            
            <form id="renderPromptForm">
                
                <!-- Main Description -->
                <div class="form-group">
                    <label for="main_description">
                        <span class="material-symbols-rounded">edit_note</span>
                        Loại công trình (Building Type)
                    </label>
                    <textarea id="main_description" rows="2" placeholder="AI sẽ điền tự động sau khi phân tích..."></textarea>
                </div>

                <!-- Facade Style Field -->
                <div class="form-group">
                    <label for="facade_style">
                        <span class="material-symbols-rounded">home_work</span>
                        Phong cách Kiến trúc
                    </label>
                    <input type="text" id="facade_style" placeholder="Ví dụ: Modern minimalist, Neoclassical, Indochine...">
                </div>

                <!-- Floor Count Field -->
                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="floor_count">
                            <span class="material-symbols-rounded">stacked_bar_chart</span>
                            Số tầng (Floor Count) <span style="color: var(--color-error);">*</span>
                        </label>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <button type="button" id="floorMinus" class="btn-secondary btn-compact" style="width: 44px; flex-shrink: 0; font-size: 1.25rem;">−</button>
                            <input
                                type="number"
                                id="floor_count"
                                min="1"
                                max="50"
                                value="3"
                                required
                                style="text-align: center; font-size: 1.125rem; font-weight: 600; width: 70px; padding: 0.5rem;"
                            >
                            <button type="button" id="floorPlus" class="btn-secondary btn-compact" style="width: 44px; flex-shrink: 0; font-size: 1.25rem;">+</button>
                        </div>
                        <small style="color: var(--color-text-tertiary); font-size: 0.75rem; display: block; margin-top: 0.25rem;">Số tầng chính (không tính tum/lửng)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <span class="material-symbols-rounded">layers</span>
                            Tầng lửng/Tum
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; cursor: pointer;">
                            <input type="checkbox" id="has_mezzanine" style="width: 18px; height: 18px; cursor: pointer; accent-color: var(--color-primary);">
                            <span style="font-size: var(--font-size-sm);">Có tầng lửng/tum (Mezzanine)</span>
                        </label>
                    </div>
                </div>

                <!-- Floor Details (Optional) -->
                <div class="form-group">
                    <label for="floor_details">
                        <span class="material-symbols-rounded">description</span>
                        Mô tả chi tiết tầng (Không bắt buộc)
                    </label>
                    <textarea
                        id="floor_details"
                        rows="2"
                        placeholder="VD: Tháp 1 có đế 4 tầng + thân 10 tầng, Tháp 2 có 8 tầng. Hoặc: 3 tầng + 1 tum"></textarea>
                    <small style="color: var(--color-text-tertiary); font-size: 0.75rem; display: block; margin-top: 0.25rem;">
                        Dùng cho công trình phức tạp như tháp đôi, hoặc có nhiều phân đoạn tầng khác nhau
                    </small>
                </div>

                <!-- Aspect Ratio & Viewpoint -->
                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="aspect_ratio">
                            <span class="material-symbols-rounded">aspect_ratio</span>
                            Tỷ lệ khung hình
                        </label>
                        <select id="aspect_ratio">
                            <option value="" disabled selected>Đang tải...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="viewpoint">
                            <span class="material-symbols-rounded">videocam</span>
                            Góc nhìn (Camera)
                        </label>
                        <select id="viewpoint">
                            <option value="match_sketch" selected>Góc nhìn như sketch gốc (Mặc định)</option>
                            <option value="main_facade">Mặt tiền chính</option>
                            <option value="three_quarter">Góc 3/4 (45°)</option>
                            <option value="aerial_angle">Góc cao (Bird's eye)</option>
                            <option value="low_angle">Góc thấp (Worm's eye)</option>
                            <option value="balcony_closeup">Cận cảnh ban công</option>
                            <option value="entrance_detail">Chi tiết lối vào</option>
                            <option value="interior_exterior">Từ trong nhìn ra</option>
                        </select>
                    </div>
                </div>

                <!-- Fidelity Slider -->
                <div class="form-group">
                    <label for="sketch_adherence">
                        Độ bám sát Sketch: 
                        <span id="sketch_adherence_value" class="range-value">0.95</span>
                    </label>
                    <input type="range" id="sketch_adherence" min="0.5" max="1.0" step="0.01" value="0.95" class="range-slider">
                    <div class="range-labels">
                        <span>Sáng tạo</span>
                        <span>Chính xác</span>
                    </div>
                </div>

                <!-- Collapsible Sections -->
                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Yếu tố then chốt (Critical Elements)
                    </summary>
                    <div class="section-content">
                        <div id="criticalElementsContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="criticalElementsContainer" data-type="element">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm yếu tố
                        </button>
                    </div>
                </details>

                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Vật liệu chi tiết
                    </summary>
                    <div class="section-content">
                        <div id="materialsPreciseContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="materialsPreciseContainer" data-type="material">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm vật liệu
                        </button>
                    </div>
                </details>

                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Môi trường & Bối cảnh
                    </summary>
                    <div class="section-content">
                        <!-- Location / Space -->
                        <div class="form-group">
                            <label for="env_location">
                                <span class="material-symbols-rounded">location_on</span>
                                Không gian (Location)
                            </label>
                            <select id="env_location">
                                <option value="">-- Chọn hoặc tự điền --</option>
                                <option value="Nằm trong khu đô thị hiện đại">Khu đô thị hiện đại</option>
                                <option value="Nằm trong thành phố Hà Nội">Thành phố Hà Nội</option>
                                <option value="Nằm trong thành phố Hồ Chí Minh">TP Hồ Chí Minh</option>
                                <option value="Nằm tại ngã 4 thành phố đông đúc">Ngã 4 đông đúc</option>
                                <option value="Khu vực ven sông, view mở">Ven sông, view mở</option>
                                <option value="Khu dân cư yên tĩnh">Khu dân cư yên tĩnh</option>
                                <option value="Trung tâm thương mại">Trung tâm thương mại</option>
                                <option value="custom">Tự điền...</option>
                            </select>
                            <input type="text" id="env_location_custom" class="hidden" placeholder="Mô tả không gian tùy chỉnh..." style="margin-top: 0.5rem;">
                        </div>

                        <!-- Time of Day -->
                        <div class="form-group">
                            <label for="env_time">
                                <span class="material-symbols-rounded">schedule</span>
                                Thời điểm (Time of Day)
                            </label>
                            <select id="env_time">
                                <option value="">-- Chọn hoặc tự điền --</option>
                                <option value="Buổi sáng sớm, ánh sáng dịu">Buổi sáng sớm</option>
                                <option value="Giờ vàng (Golden hour), ánh nắng ấm" selected>Giờ vàng (Golden hour)</option>
                                <option value="Buổi trưa, nắng gắt">Buổi trưa</option>
                                <option value="Chiều tà, ánh nắng nghiêng">Chiều tà</option>
                                <option value="Buổi tối, đèn đường bật sáng">Buổi tối</option>
                                <option value="Ban đêm, ánh đèn lung linh">Ban đêm</option>
                                <option value="custom">Tự điền...</option>
                            </select>
                            <input type="text" id="env_time_custom" class="hidden" placeholder="Mô tả thời điểm tùy chỉnh..." style="margin-top: 0.5rem;">
                        </div>

                        <!-- Weather -->
                        <div class="form-group">
                            <label for="env_weather">
                                <span class="material-symbols-rounded">cloud</span>
                                Thời tiết (Weather)
                            </label>
                            <select id="env_weather">
                                <option value="">-- Chọn hoặc tự điền --</option>
                                <option value="Trời quang, nắng đẹp" selected>Trời quang, nắng đẹp</option>
                                <option value="Nhiều mây, ánh sáng dịu">Nhiều mây</option>
                                <option value="Mưa nhẹ, bầu trời u ám">Mưa nhẹ</option>
                                <option value="Sương mù nhẹ buổi sáng">Sương mù nhẹ</option>
                                <option value="Gió nhẹ, cây cối đung đưa">Gió nhẹ</option>
                                <option value="custom">Tự điền...</option>
                            </select>
                            <input type="text" id="env_weather_custom" class="hidden" placeholder="Mô tả thời tiết tùy chỉnh..." style="margin-top: 0.5rem;">
                        </div>

                        <!-- Vehicles -->
                        <div class="form-group">
                            <label for="env_vehicles">
                                <span class="material-symbols-rounded">directions_car</span>
                                Xe cộ (Vehicles)
                            </label>
                            <select id="env_vehicles">
                                <option value="">Không có xe cộ</option>
                                <option value="Xe ô tô và xe máy đi lại trên đường" selected>Ô tô + Xe máy</option>
                                <option value="Xe ô tô và xe đạp đi lại">Ô tô + Xe đạp</option>
                                <option value="Xe buýt và xe máy">Xe buýt + Xe máy</option>
                                <option value="Chỉ có xe đạp">Chỉ xe đạp</option>
                                <option value="Xe đậu hai bên đường">Xe đậu hai bên đường</option>
                                <option value="custom">Tự điền...</option>
                            </select>
                            <input type="text" id="env_vehicles_custom" class="hidden" placeholder="Mô tả xe cộ tùy chỉnh..." style="margin-top: 0.5rem;">
                        </div>

                        <!-- People -->
                        <div class="form-group">
                            <label for="env_people">
                                <span class="material-symbols-rounded">groups</span>
                                Người (People)
                            </label>
                            <select id="env_people">
                                <option value="">Không có người</option>
                                <option value="Đông người đi lại, ra vào tòa nhà">Đông người ra vào</option>
                                <option value="Nhóm nhỏ người đi lại trên đường" selected>Nhóm nhỏ đi lại</option>
                                <option value="Đông người, nhóm uống cà phê trên vỉa hè">Đông người + Cafe vỉa hè</option>
                                <option value="Người tản bộ công viên">Người tản bộ</option>
                                <option value="Người ngồi ghế đá">Người ngồi thư giãn</option>
                                <option value="custom">Tự điền...</option>
                            </select>
                            <input type="text" id="env_people_custom" class="hidden" placeholder="Mô tả người tùy chỉnh..." style="margin-top: 0.5rem;">
                        </div>

                        <!-- Additional Context (Optional) -->
                        <div class="form-group">
                            <label for="env_additional">
                                <span class="material-symbols-rounded">more_horiz</span>
                                Bối cảnh bổ sung (Tùy chọn)
                            </label>
                            <textarea id="env_additional" rows="2" placeholder="VD: Cây xanh hai bên đường, vườn hoa trước nhà, hàng rào sắt..."></textarea>
                        </div>
                    </div>
                </details>
                
                <!-- Inpainting Section -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Chỉnh sửa vùng cụ thể (Inpainting)
                    </summary>
                    <div class="section-content">
                        <!-- Instructions -->
                        <div class="info-box warning" style="margin-bottom: 1rem;">
                            <strong><span class="material-symbols-rounded icon-sm">help</span> Hướng dẫn tạo Mask:</strong>
                            <ol style="margin-top: 0.5rem; padding-left: 1.2rem; font-size: 0.75rem; line-height: 1.6;">
                                <li>Mở ảnh render trong Photoshop/GIMP/Paint.NET</li>
                                <li>Tạo layer mới, fill đen (RGB: 0,0,0)</li>
                                <li>Vẽ TRẮNG (RGB: 255,255,255) vào vùng cần sửa</li>
                                <li>Xuất ảnh mask dạng PNG/JPG</li>
                            </ol>
                            <p style="color: var(--color-warning); margin-top: 0.5rem; font-weight: 600; font-size: 0.75rem;">
                                Quy tắc: <strong>Trắng = Sửa | Đen = Giữ nguyên</strong>
                            </p>
                        </div>

                        <!-- Upload Mask -->
                        <div class="form-group">
                            <label for="uploadMask">
                                <span class="material-symbols-rounded">image</span>
                                Upload Mask Image
                            </label>
                            <input type="file" id="uploadMask" accept="image/*">
                            <div id="maskPreview" class="hidden" style="margin-top: 0.5rem;">
                                <img id="maskPreviewImage" src="" alt="Mask preview" style="max-width: 200px; border: 2px solid var(--color-border); border-radius: var(--radius-lg);">
                            </div>
                        </div>

                        <!-- Edit Instruction -->
                        <div class="form-group">
                            <label for="inpaintInstruction">
                                <span class="material-symbols-rounded">edit</span>
                                Mô tả thay đổi (Edit Instruction)
                            </label>
                            <textarea id="inpaintInstruction" rows="3" placeholder="Ví dụ: Add hanging plants on balcony railings, Add national flag on rooftop"></textarea>
                        </div>

                        <!-- Apply Button -->
                        <button type="button" id="applyInpaintBtn" class="btn-primary" disabled style="width: 100%;">
                            <span class="material-symbols-rounded">brush</span>
                            Áp dụng Inpainting
                        </button>
                    </div>
                </details>

                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Từ khóa Phong cách
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="style_keywords">
                                <span class="material-symbols-rounded">style</span>
                                Keywords
                            </label>
                            <input type="text" id="style_keywords" placeholder="professional architectural photography, 8K UHD..." value="professional architectural photography, hyper-realistic rendering, 8K UHD, cinematic color grading">
                        </div>
                    </div>
                </details>

                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Thông số Kỹ thuật
                    </summary>
                    <div class="section-content">
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label for="tech_camera">
                                    <span class="material-symbols-rounded">photo_camera</span>
                                    Máy ảnh
                                </label>
                                <input type="text" id="tech_camera" value="Canon EOS 5D Mark IV">
                            </div>
                            <div class="form-group">
                                <label for="tech_lens">
                                    <span class="material-symbols-rounded">camera</span>
                                    Ống kính
                                </label>
                                <input type="text" id="tech_lens" value="24mm wide-angle">
                            </div>
                            <div class="form-group">
                                <label for="tech_lighting">
                                    <span class="material-symbols-rounded">light_mode</span>
                                    Ánh sáng
                                </label>
                                <input type="text" id="tech_lighting" value="natural sunlight, golden hour">
                            </div>
                        </div>
                    </div>
                </details>

                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Negative Prompt
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="negative_prompt">
                                <span class="material-symbols-rounded">block</span>
                                Avoid keywords
                            </label>
                            <textarea id="negative_prompt" rows="3">sketch, drawing, illustration, cartoon, anime, blurry, low resolution, distorted proportions, unrealistic lighting</textarea>
                        </div>
                    </div>
                </details>
            </form>
        </main>

        <!-- =============================================== -->
        <!-- COLUMN 3: OUTPUT & ACTIONS -->
        <!-- =============================================== -->
        <aside class="panel panel-output">
            <div class="panel-header">
                <span class="step-badge">Bước 3</span>
                <h2>Kết quả Render</h2>
            </div>
            
            <!-- Action Buttons -->
            <div class="output-actions">
                <!-- Export JSON button will be inserted here by JS -->

                <button id="generateRenderButton" class="btn-submit" disabled>
                    <span id="renderSpinner" class="spinner hidden"></span>
                    <span class="material-symbols-rounded">play_arrow</span>
                    Tạo Render
                </button>
            </div>

            <!-- Messages -->
            <div id="renderError" class="message error-message hidden"></div>
            <div id="renderSuccess" class="message success-message hidden"></div>

            <!-- Gallery -->
            <div id="gallery" class="gallery">
                <div class="gallery-placeholder">
                    <span class="material-symbols-rounded">image</span>
                    <p>Kết quả render sẽ xuất hiện ở đây</p>
                </div>
            </div>

            <!-- Output Controls -->
            <div id="outputControls" class="output-controls hidden">
                <button id="downloadImageBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">download</span>
                    Tải về
                </button>
                <button id="regenerateBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">refresh</span>
                    Tạo lại
                </button>
                <button id="refineBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">tune</span>
                    Tinh chỉnh
                </button>
            </div>

            <!-- Refine Controls (Initially Hidden) -->
            <div id="refineControls" class="refine-controls hidden">
                <div class="info-box warning" style="margin-bottom: 0.75rem;">
                    <strong><span class="material-symbols-rounded icon-sm">lightbulb</span> Hướng dẫn:</strong>
                    <p style="margin-top: 0.5rem; font-size: 0.75rem;">
                        Nhập chỉ dẫn đơn giản để tinh chỉnh ảnh render (ví dụ: "Giữ đúng góc nhìn như sketch gốc", "Sửa màu sắc tòa nhà")
                    </p>
                </div>
                <textarea
                    id="refineInstruction"
                    rows="3"
                    placeholder="VD: Giữ nguyên tuyệt đối góc nhìn như ảnh sketch gốc, không xoay camera"></textarea>
                <div class="btn-row">
                    <button id="applyRefineBtn" class="btn-primary">
                        <span id="refineSpinner" class="spinner hidden"></span>
                        <span class="material-symbols-rounded">check</span>
                        Áp dụng tinh chỉnh
                    </button>
                    <button id="cancelRefineBtn" class="btn-secondary">
                        <span class="material-symbols-rounded">close</span>
                        Hủy
                    </button>
                </div>
            </div>
            
            <!-- Stats Box -->
            <div id="statsBox" class="stats-box hidden">
                <div class="stat-item">
                    <span class="stat-label">Thời gian:</span>
                    <span class="stat-value" id="statTime">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Kích thước:</span>
                </div>
            </div>
        </aside>



    </div>
    <!-- END MAIN CONTAINER -->

    <!-- FOOTER -->
    <footer class="app-footer">
        <p>Made by <strong>Nam Ta</strong> + <strong>Gemini AI</strong></p>
        <p>©2025 • Architecture S2R Tool • All rights reserved</p>
    </footer>

    <!-- JavaScript -->
    <script src="version-check.js"></script>
    <script src="building-script.js?v=1762859322"></script>
</body>
</html>