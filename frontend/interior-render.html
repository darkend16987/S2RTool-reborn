<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interior Render - S2R Tool</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
</head>
<body>

    <!-- HEADER -->
    <header class="app-header">
        <div class="header-content">
            <h1>
                <span class="material-symbols-rounded">living</span>
                Interior Render
            </h1>
            <span class="header-divider"></span>
            <p class="header-subtitle">Interior Sketch to Photorealistic Render • Powered by Gemini AI</p>
        </div>
    </header>

    <!-- BACK TO HOME -->
    <nav class="back-nav">
        <a href="index.html" class="back-link">
            <span class="material-symbols-rounded">arrow_back</span>
            Về trang chủ
        </a>
    </nav>

    <!-- INTERIOR MODE CONTAINER -->
    <div class="main-container">

        <!-- =============================================== -->
        <!-- COLUMN 1: INPUT SKETCH -->
        <!-- =============================================== -->
        <aside class="panel panel-input">
            <div class="panel-header">
                <span class="step-badge">Bước 1</span>
                <h2>Upload Sketch Nội Thất</h2>
            </div>

            <!-- Image Uploader -->
            <div id="imageUploader" class="image-uploader">
                <input type="file" id="uploadSketch" accept="image/*" style="display: none;">
                <label for="uploadSketch" id="uploadLabel" class="upload-label">
                    <span class="material-symbols-rounded">cloud_upload</span>
                    <span class="upload-text">Kéo thả hoặc nhấn để tải ảnh</span>
                    <span class="upload-hint">JPG, PNG • Max 16MB</span>
                </label>
                <img id="previewImage" src="" alt="Sketch preview" class="preview-image hidden">
            </div>

            <!-- Reference Image Upload (for multi-angle consistency) -->
            <details class="form-section" style="margin-top: 0.75rem;">
                <summary>
                    <span class="material-symbols-rounded">chevron_right</span>
                    Ảnh Tham Khảo (Reference) - Optional
                </summary>
                <div class="section-content">
                    <p style="color: var(--color-text-secondary); font-size: 0.75rem; margin-bottom: 0.75rem; line-height: 1.5;">
                        <strong>Render nhiều góc của cùng 1 phòng:</strong><br>
                        Upload ảnh góc đã render để AI giữ màu sắc, vật liệu, ánh sáng nhất quán.
                    </p>
                    <div class="image-uploader" style="min-height: 100px; aspect-ratio: auto;">
                        <input type="file" id="uploadReference" accept="image/*" style="display: none;">
                        <label for="uploadReference" id="uploadReferenceLabel" class="upload-label">
                            <span class="material-symbols-rounded" style="font-size: 32px;">add_photo_alternate</span>
                            <span class="upload-text" style="font-size: 0.8rem;">Upload Reference</span>
                        </label>
                        <img id="previewReference" src="" alt="Reference preview" class="preview-image hidden">
                    </div>
                    <button type="button" id="clearReferenceButton" class="btn-remove" style="display: none; margin-top: 0.5rem; width: 100%; font-size: 0.75rem;">
                        <span class="material-symbols-rounded icon-sm">close</span> Xóa Reference
                    </button>
                </div>
            </details>

            <!-- Analyze Button -->
            <button id="analyzeSketchButton" class="btn-primary" disabled>
                <span id="analyzeSpinner" class="spinner hidden"></span>
                <span class="material-symbols-rounded">auto_awesome</span>
                Phân tích Sketch (AI)
            </button>

            <!-- Messages -->
            <div id="analyzeError" class="message error-message hidden"></div>
            <div id="analyzeSuccess" class="message success-message hidden"></div>

            <!-- Info Box -->
            <div class="info-box">
                <strong><span class="material-symbols-rounded icon-sm">lightbulb</span> Tips:</strong>
                <ul>
                    <li>Sketch rõ ràng vị trí đồ nội thất</li>
                    <li>Thể hiện tỷ lệ và quan hệ không gian</li>
                    <li>Có thể là vẽ tay hoặc CAD</li>
                </ul>
            </div>
        </aside>

        <!-- =============================================== -->
        <!-- COLUMN 2: PARAMETERS FORM -->
        <!-- =============================================== -->
        <main class="panel panel-form">
            <div class="panel-header">
                <span class="step-badge">Bước 2</span>
                <h2>Tinh chỉnh Thông số</h2>
            </div>

            <form id="renderPromptForm">

                <!-- Room Type -->
                <div class="form-group">
                    <label for="room_type">
                        <span class="material-symbols-rounded">meeting_room</span>
                        Loại phòng (Room Type)
                    </label>
                    <textarea id="room_type" rows="2" placeholder="AI sẽ điền tự động sau khi phân tích..."></textarea>
                </div>

                <!-- Interior Style -->
                <div class="form-group">
                    <label for="interior_style">
                        <span class="material-symbols-rounded">palette</span>
                        Phong cách Nội thất
                    </label>
                    <input type="text" id="interior_style" placeholder="Ví dụ: Modern Minimalist, Scandinavian, Industrial...">
                </div>

                <!-- Viewpoint (Camera Angle) -->
                <div class="form-group">
                    <label for="viewpoint">
                        <span class="material-symbols-rounded">videocam</span>
                        Góc nhìn (Camera)
                    </label>
                    <select id="viewpoint">
                        <option value="match_sketch" selected>Góc nhìn như sketch gốc (Mặc định)</option>
                        <option value="three_quarter">Góc 3/4 (45°)</option>
                        <option value="aerial_angle">Góc cao (Bird's eye)</option>
                        <option value="low_angle">Góc thấp (Worm's eye)</option>
                        <option value="side_elevation">Mặt bên</option>
                        <option value="interior_exterior">Nội ngoại thất (Cutaway)</option>
                    </select>
                    <small style="color: var(--color-text-tertiary); font-size: 0.75rem; margin-top: 0.25rem; display: block;">
                        "Góc nhìn như sketch gốc" sẽ tôn trọng chặt chẽ bố cục, vị trí, hướng nhìn của sketch
                    </small>
                </div>

                <!-- Aspect Ratio & Sketch Adherence -->
                <div class="form-grid-2">
                    <div class="form-group">
                        <label for="aspect_ratio">
                            <span class="material-symbols-rounded">aspect_ratio</span>
                            Tỷ lệ khung hình
                        </label>
                        <select id="aspect_ratio">
                            <option value="" disabled selected>Đang tải...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="sketch_adherence">
                            <span class="material-symbols-rounded">tune</span>
                            Độ bám sát Sketch:
                            <span id="sketch_adherence_value" class="range-value">0.99</span>
                        </label>
                        <input type="range" id="sketch_adherence" min="0.95" max="1.0" step="0.01" value="0.99" class="range-slider">
                        <div class="range-labels">
                            <span>Linh hoạt</span>
                            <span>Chính xác</span>
                        </div>
                    </div>
                </div>

                <!-- Collapsible: Furniture Layout -->
                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Bố trí Nội thất (Furniture Layout)
                    </summary>
                    <div class="section-content">
                        <div id="furnitureLayoutContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="furnitureLayoutContainer" data-type="furniture">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm đồ nội thất
                        </button>
                    </div>
                </details>

                <!-- Collapsible: Wall Treatments -->
                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Vật liệu Tường (Wall Treatments)
                    </summary>
                    <div class="section-content">
                        <div id="wallTreatmentsContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="wallTreatmentsContainer" data-type="wall">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm tường
                        </button>
                    </div>
                </details>

                <!-- Collapsible: Flooring -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Sàn nhà (Flooring)
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="flooring_type">Loại sàn:</label>
                            <input type="text" id="flooring_type" placeholder="VD: Sàn gỗ sồi, Sàn gạch, Sàn đá marble...">
                        </div>
                        <div class="form-group">
                            <label for="flooring_description">Mô tả chi tiết:</label>
                            <textarea id="flooring_description" rows="2" placeholder="VD: Sàn gỗ sồi tự nhiên màu sáng, vân gỗ rõ nét, độ bóng mờ..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="flooring_rug">Thảm trải (nếu có):</label>
                            <input type="text" id="flooring_rug" placeholder="VD: Thảm len xám lớn, kết cấu dệt thô...">
                        </div>
                    </div>
                </details>

                <!-- Collapsible: Ceiling -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Trần nhà (Ceiling)
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="ceiling_type">Loại trần:</label>
                            <input type="text" id="ceiling_type" placeholder="VD: Trần thạch cao phẳng, Trần giật cấp, Trần gỗ...">
                        </div>
                        <div class="form-group">
                            <label for="ceiling_lighting">Hệ thống ánh sáng trần:</label>
                            <textarea id="ceiling_lighting" rows="2" placeholder="VD: Khe hắt sáng LED trắng, Đèn âm trần, Đèn chùm..."></textarea>
                        </div>
                    </div>
                </details>

                <!-- Collapsible: Lighting -->
                <details class="form-section" open>
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Hệ thống Ánh sáng (Lighting)
                    </summary>
                    <div class="section-content">
                        <div id="lightingContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="lightingContainer" data-type="lighting">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm nguồn sáng
                        </button>
                    </div>
                </details>

                <!-- Collapsible: Decorations -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Đồ trang trí (Decorations)
                    </summary>
                    <div class="section-content">
                        <div id="decorationsContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="decorationsContainer" data-type="decoration">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm đồ trang trí
                        </button>
                    </div>
                </details>

                <!-- Collapsible: Windows & Doors -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Cửa sổ & Cửa ra vào
                    </summary>
                    <div class="section-content">
                        <div id="windowsDoorsContainer" class="dynamic-container"></div>
                        <button type="button" class="btn-add" data-container="windowsDoorsContainer" data-type="window_door">
                            <span class="material-symbols-rounded icon-sm">add</span> Thêm cửa
                        </button>
                    </div>
                </details>

                <!-- Collapsible: Environment & Atmosphere -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Môi trường & Bầu không khí
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="env_atmosphere">Bầu không khí:</label>
                            <textarea id="env_atmosphere" rows="2" placeholder="VD: Sang trọng và ấm cúng, Thoáng đãng và hiện đại, Yên tĩnh..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="env_time">Thời điểm trong ngày:</label>
                            <select id="env_time">
                                <option value="">-- Chọn --</option>
                                <option value="Ban ngày, ánh sáng tự nhiên" selected>Ban ngày</option>
                                <option value="Buổi tối, đèn bật sáng">Buổi tối</option>
                                <option value="Hoàng hôn, ánh nắng nghiêng">Hoàng hôn</option>
                                <option value="Ban đêm, ánh đèn ấm">Ban đêm</option>
                            </select>
                        </div>
                    </div>
                </details>

                <!-- Collapsible: Technical Specs -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Thông số Kỹ thuật
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="tech_camera">Góc nhìn camera:</label>
                            <input type="text" id="tech_camera" value="Eye-level perspective, full room view">
                        </div>
                        <div class="form-group">
                            <label for="tech_lens">Ống kính:</label>
                            <input type="text" id="tech_lens" value="24-35mm wide-angle">
                        </div>
                        <div class="form-group">
                            <label for="tech_lighting_emphasis">Nhấn mạnh ánh sáng:</label>
                            <input type="text" id="tech_lighting_emphasis" value="High contrast, deep shadows, crisp highlights">
                        </div>
                        <div class="form-grid-2">
                            <div class="form-group">
                                <label for="tech_contrast">Tăng Contrast:</label>
                                <input type="text" id="tech_contrast" value="+20%">
                            </div>
                            <div class="form-group">
                                <label for="tech_sharpness">Tăng Sharpness:</label>
                                <input type="text" id="tech_sharpness" value="+10%">
                            </div>
                        </div>
                    </div>
                </details>

                <!-- Collapsible: Style Keywords -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Từ khóa Phong cách
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="style_keywords">
                                <span class="material-symbols-rounded">style</span>
                                Keywords
                            </label>
                            <input type="text" id="style_keywords" placeholder="professional interior photography, 8K UHD..." value="photorealistic interior rendering, 8K UHD, high dynamic range, ultra-sharp material details, Architectural Digest quality">
                        </div>
                    </div>
                </details>

                <!-- Collapsible: Negative Prompt -->
                <details class="form-section">
                    <summary>
                        <span class="material-symbols-rounded">chevron_right</span>
                        Negative Prompt
                    </summary>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="negative_prompt">
                                <span class="material-symbols-rounded">block</span>
                                Avoid keywords
                            </label>
                            <textarea id="negative_prompt" rows="3">sketch, drawing, illustration, cartoon, anime, blurry, low resolution, distorted proportions, unrealistic lighting, adding extra furniture, moving objects, changing layout</textarea>
                        </div>
                    </div>
                </details>
            </form>
        </main>

        <!-- =============================================== -->
        <!-- COLUMN 3: OUTPUT & ACTIONS -->
        <!-- =============================================== -->
        <aside class="panel panel-output">
            <div class="panel-header">
                <span class="step-badge">Bước 3</span>
                <h2>Kết quả Render</h2>
            </div>

            <!-- Action Buttons -->
            <div class="output-actions">
                <button id="generateRenderButton" class="btn-submit" disabled>
                    <span id="renderSpinner" class="spinner hidden"></span>
                    <span class="material-symbols-rounded">play_arrow</span>
                    Tạo Render
                </button>
            </div>

            <!-- Messages -->
            <div id="renderError" class="message error-message hidden"></div>
            <div id="renderSuccess" class="message success-message hidden"></div>

            <!-- Gallery -->
            <div id="gallery" class="gallery">
                <div class="gallery-placeholder">
                    <span class="material-symbols-rounded">image</span>
                    <p>Kết quả render sẽ xuất hiện ở đây</p>
                </div>
            </div>

            <!-- Output Controls -->
            <div id="outputControls" class="output-controls hidden">
                <button id="downloadImageBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">download</span>
                    Tải về
                </button>
                <button id="regenerateBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">refresh</span>
                    Tạo lại
                </button>
                <button id="refineBtn" class="btn-secondary btn-icon">
                    <span class="material-symbols-rounded">tune</span>
                    Tinh chỉnh
                </button>
            </div>

            <!-- Stats Box -->
            <div id="statsBox" class="stats-box hidden">
                <div class="stat-item">
                    <span class="stat-label">Thời gian:</span>
                    <span class="stat-value" id="statTime">-</span>
                </div>
            </div>
        </aside>

    </div>
    <!-- END MAIN CONTAINER -->

    <!-- FOOTER -->
    <footer class="app-footer">
        <p>Made by <strong>Nam Ta</strong> + <strong>Gemini AI</strong></p>
        <p>©2025 • Interior S2R Tool • All rights reserved</p>
    </footer>

    <!-- JavaScript -->
    <script src="version-check.js"></script>
    <script src="interior-script.js?v=1"></script>
</body>
</html>
